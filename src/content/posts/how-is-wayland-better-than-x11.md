---
title: Wayland 比 X11 好在哪里
pubDate: '2025-09-14'
---

更现代的 Wayland 近几年才被采纳为各大发行版的默认显示协议，那么它究竟比 X11 好在哪里呢？

## 更好的渲染

Wayland 支持分数缩放与多显示器使用不同缩放，缩放在 X11 上就一直是个问题，如果你有一台 27 寸 4K（~163 PPI）和一台 24 寸 1080P（~92 PPI）的显示器，你会发现你不能将两台显示器单独设置缩放，只能两台都设置成 100% 或者 200% 的缩放，而 Wayland 允许你设置一台 100% 和一台 175%（`1.75 == 7/4`，是分数！）的缩放。

如果你看过 ThePrimeagen 的视频，你会注意到他的录屏里总是出现屏幕撕裂，这是 X11 的常见问题。而 Wayland 则默认没有任何屏幕撕裂，渲染的每一帧都是完美的。如果你玩竞技游戏并需要更低的延迟，你也可以选择开启 asynchronous presentation，但是当然也会导致屏幕撕裂。

各大 Wayland 混成器也在逐渐支持 HDR，可以提供更广阔的色彩，提高你在游戏或视频中的体验。

## 统一的协议

一个经典的例子就是输入法，fcitx5 输入法在 Linux X11 下需要设置 `{QT,GTK}_IMMODULE`、`XMODIFIERS=@im=fcitx` 与 Kimpanel 并安装对应软件包才能使输入法工作，这里用到了 Qt4/5/6 IM module、GTK2/3/4 IM module、XIM 与 Kimpanel，这导致用户的输入体验极其割裂：

基于 IM Module 的实现需要被输入的软件加载 `im-fcitx5.so` 并自行渲染输入法的界面，有时软件难免会不支持一些输入法皮肤的特性，导致界面出现 bug。

并且 XIM 有一个问题：打字时动不动就会漏字，在像 Steam 这种基于 `libcef`、只支持 XIM 的软件上，用户的体验就会很差。

Kimpanel 则是 KDE 与 GNOME 独占，如果你凑巧用的是其他桌面环境（如 XFCE），你就没办法了。

Wayland 的输入法协议[尽管不完美](https://dorotac.eu/posts/input_broken/)，但起码对用户体验提供了一个基础，Wayland 的 `text-input-v3`（输入法与软件间的协议）与 `input-method-v2`（输入法与混成器间的协议）协议各大桌面与软件也基本支持，输入法界面则由混成器渲染。对用户来说，安装并启动 fcitx5 后 Wayland 输入法就是开箱即用，不需要任何配置。

Wayland 的驱动方面也统一很多，X11 需要很多 `xf86-video-*`、`xf86-input-*` 各种奇奇怪怪的用户态驱动，而 Wayland 世界就简单的多：显卡厂商只要写好内核驱动 + Mesa 就能在所有混成器上用；输入输出是直接走内核（evdev + DRM/KMS），混成器只需要调用 libinput 处理输入，再用 GBM、EGL 把图像渲染到屏幕上。

## 安全问题

X 已经有四十多年历史了，于 1984 年六月诞生，它在现在历史包袱已经数不胜数，而许多问题则是由 X 的架构的设计缺陷带来的，如 X 的安全问题就经常被谈起。

首先，早期的 X 默认以 `root` 用户运行，这导致了攻击面极大，尽管 X11 支持 Rootless X，但还有部分软件（如 LightDM）还不支持，依然存在兼容性问题。

X11 没有任何权限管理，而在 Wayland 理论上[^1]用户需明确同意软件才能被允许进行截图或屏幕录制。

[^1]: 很遗憾，wlroot 系混成器的 wlr-screencopy 协议暂时不支持权限管理，依然可以直接截图。

并且，任何运行中的应用程序都能读取整个桌面的输入事件，理论上任何人都能利用这一特点十分轻松的写出一个 keylogger。现代 macOS 在 Catalina 后也增加了权限管理，而 Windows API 则是没有任何限制。
